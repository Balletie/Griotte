<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Griotte: Code Review for Pharo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Highlight js -->
    <link rel="stylesheet" href="./support/html/highlightjs/styles/googlecode.css">
    <script src="./support/html/highlightjs/highlight.pack.js"></script>

    <link rel="stylesheet" href="./support/html/stylesheet.css">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div id="content" class="inner">
      <h1 class="top">Griotte: Code Review for Pharo</h1>
      <h3>Developer Documentation</h3>
      <section>
<h1>1. Overview</h1>
<a id="overview"></a>
<p>
<em>Griotte</em> is an <em>experiment</em> in Modern Code Review with two goals:
</p>
<ol><li>Improving the code review process in the <a href="http://pharo.org">Pharo</a> programming language and environment.</li>
<li>Improving code review in general.</li>
</ol>

<p>
In general, we aim to improve code review with the concept of <em>groups of changes</em>. This document does not go in-depth on this topic, but there are other documents which discuss this topic.
</p>
<p>
Within Pharo specifically, one of the goals was to leverage existing services for doing code review, and creating a frontend within Pharo to use them. This means that one uses for example GitHub as their backend, and doing the code review process within Pharo. The Pharo frontend then enables the use of groups and other special features by storing metadata in the backend service. One can imagine using <code>git-notes</code> to do this in the case of Git repositories.
</p>
<p>
There is currently one backend implementation which is for GitHub. It uses the <a href="https://balletie.github.io/GitHub">GitHub API Bindings</a> internally. It also serves as a reference implementation for possible future backends.
</p>
<p>
Currently, both the UI and the model don't actually allow for full code review yet. The aforementioned concept of <em>groups</em> is yet to be implemented, and it is the main component which will enable the process of code review.
</p>
<section>
<h2>1.1. Further Documentation</h2>

<p>
The documentation is split into three parts:
</p>
<ol><li><a href="#model">2 The Model</a>: Explains briefly the model of Griotte, and Epicea's fine-grained IDE events.</li>
<li><a href="#backend">3 Backends</a>: How Griotte integrates with backends and versioning tools.</li>
<li><a href="#ui">4 The UI</a>: Some words about the UI, and approaches for extending it.</li>
</ol>

</section><section>
<h2>1.2. Installation</h2>

<p>
To install and try Griotte, run the following Metacello script (taken from the <a href="https://balletie.github.io/Griotte">homepage</a>) in a Pharo 5 image:
</p>
<figure><pre><code class="smalltalk">Metacello new
	baseline: 'Griotte';
	repository: 'github://Balletie/Griotte:master';
	load.</code></pre><figcaption></figcaption></figure>

<p>
This will also load a tool to do basic versioning in GitHub repositories. Griotte integrates with this tool to create new reviews.

</p></section></section><section>
<h1>2. The Model</h1>
<a id="model"></a>
<p>
This part describes the abstractions, or model, relevant to Griotte. It discusses Griotte's own model, as well as <em>Epicea</em>'s model for <em>fine-grained IDE events</em>.
</p>
<section>
<h2>2.1. Griotte's Model</h2>

<p>
Griotte's model consists of several abstract classes which require to be implemented by a backend. In other words, the classes of the model define a set of operations and accessors which a backend should be able to perform and provide for. The model is defined as follows:
</p>
<dl><dt><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrUser.class/README.md">GrUser</a></code></dt>
<dd>A user represents someone that performs operations in a review. They can be asked for the repositories that they own.</dd>
<dd>By design, this is an immutable class. This is useful because in this way, one can for example compare a user of a comment with the logged in user of the current <em>context</em> (see the <a href="#context-expl">2.1 explanation on GrContext</a>).</dd>
<dd>One can then display for example in a comment or a review, that the person who made that comment is the one that is logged in (i.e. <em>you</em>).</dd>
<dt><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrRepository.class/README.md">GrRepository</a></code></dt>
<dd>A repository is in principle a collection of reviews, as far as we are concerned. It can return the <em>local reviews</em>, those active in Griotte, and non-local reviews.</dd>
<dd>It allows for the creation of new reviews, through <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrRepository.class/README.md">GrRepository</a></code><code>&gt;&gt;</code><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrRepository.class/instance/newReviewWithTitle.description..st">newReviewWithTitle:description:</a></code>.</dd>
<dt><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrReview.class/README.md">GrReview</a></code></dt>
<dd>A review is a request for a change to be integrated into the system. It supports two basic operations: <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrReview.class/README.md">GrReview</a></code><code>&gt;&gt;</code><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrReview.class/instance/approve.st">approve</a></code> or <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrReview.class/README.md">GrReview</a></code><code>&gt;&gt;</code><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrReview.class/instance/reject.st">reject</a></code>.</dd>
<dd>It allows for a conversation of the review on a global level. These are called <em>top-level comments</em>. They can be accessed with the <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrReview.class/README.md">GrReview</a></code><code>&gt;&gt;</code><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrReview.class/instance/comments.st">comments</a></code> accessor. New top-level comments can be created using <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrReview.class/README.md">GrReview</a></code><code>&gt;&gt;</code><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrReview.class/instance/newCommentWithBody..st">newCommentWithBody:</a></code>.</dd>
<dd>Basic accessors are its title, its creator (which returns a <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrUser.class/README.md">GrUser</a></code>) and its description.</dd>
<dd>In the future, the reviews contain the groups of changes.</dd>
<dt><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrGroup.class/README.md">GrGroup</a></code></dt>
<dd>A <em>group</em> is a collection of related changes with a description. Comments can be added to groups too, allowing for a more detailed conversation. Groups can be generated by using the information provided by fine-grained IDE events (see <a href="#epicea">2.2</a> for more information).</dd>
<dd>How groups are stored is defined by the backend which implements it.</dd>
<dd>As groups are not yet implemented, the only operation that is known so far is <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrGroup.class/README.md">GrGroup</a></code><code>&gt;&gt;</code><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrGroup.class/instance/newCommentWithBody..st">newCommentWithBody:</a></code>.</dd>
<dt><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrComment.class/README.md">GrComment</a></code></dt>
<dd>A comment can be made on either a review (the aforementioned top-level comments) or on a group of changes. The model makes no distinction between comments added to groups or to reviews â€” both are just comments.</dd>
<dd>A backend can of course distinguish between these two if it is necessary for the implementation.</dd>
<dd>A comment can be edited through <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrComment.class/README.md">GrComment</a></code><code>&gt;&gt;</code><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrComment.class/instance/edit..st">edit:</a></code>, and it can be accessed for its body, creator, and both the time it was created and the time it was last updated.</dd>
<dt><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrContext.class/README.md">GrContext</a></code></dt>
</dl>
<a id="context-expl"></a><dl><dd>A relatively late addition to the model, this class represents the connection between the repositories that are locally active (those with locally active reviews), and the user that is logged in.</dd>
<dd>The interface of Griotte should allow for multiple contexts to be present at the same time, for using different backends transparently, and for <em>context switching</em> between logins.</dd>
</dl>

<section>
<h3>Local and Non-Local</h3>

<p>
In the above descriptions of the model classes, there are some references to local and non-local repositories or reviews. Local reviews are the reviews which are considered <em>active</em> â€” that is to say, the reviews that are relevant and being operated on. Local repositories are similar: they contain local reviews.
</p>
<p>
It might be desirable to support operations to remove local repositories or reviews, after you are done with reviewing for example.
</p>
</section></section><section>
<h2>2.2. Epicea Fine-Grained IDE Events</h2>
<a id="epicea"></a>
<p>
Epicea is a <a href="http://pharo.org">Pharo</a> project for recording the actions of a developer within the IDE. It was originally created for the PhD thesis of MartÃ­n Dias. The information recorded by Epicea is much more than what is recorded in the Version Control System (e.g. Git) at the point of commit; for example, Epicea records the following:
</p>
<ul>
<li>Each save of a code change (e.g. Class addition, method modification).</li>
<li>Test runs and their respective outcomes.</li>
<li>Versioning operations (commits, checkouts).</li>
<li>Refactorings.</li>
</ul>

<p>
In this sense we say that the events Epicea records are <em>fine-grained</em>, in contrast with the <em>coarse-grained</em> information stored by Version Control Systems.
</p>
<p>
The information provided by Epicea allows one to <em>group</em> changes together when committing them. These groups can then in turn be used for code review. The grouping can be done with the <em>Epicea Untangler</em>.
</p>
<section>
<h3>Epicea Untangler</h3>

<p>
Epicea Untangler is a tool which presents the developer with automatically grouped (or <em>untangled</em>) changes derived using machine learning algorithms. See the <a href="https://hal.inria.fr/hal-01116225">relevant paper</a> (Dias et al.) for more details.
</p>
<p>
The untangler can work together with Griotte when submitting a review. When the groups are correct, Griotte can store the groups in the backend service. How the storing is done is the responsibility of the backend implementations.

</p></section></section></section><section>
<h1>3. Backends</h1>
<a id="backend"></a>
<p>
Without a backend implementation, Griotte by itself cannot do anything. This documentation shows how backends are implemented, and what the connection is with versioning tools. The connection with versioning tools is explained because most code review services are tied to some versioning system.
</p>
<p>
Griotte comes shipped with a reference implementation for using it with <a href="https://github.com">GitHub</a>. Thus, examples from this implementation are given where appropriate.
</p>
<p>
In the case of the GitHub backend, everything is delegated to the <a href="https://balletie.github.io/GitHub">GitHub API Bindings</a>. 
</p>
<section>
<h2>3.1. Creating a Backend</h2>

<p>
A backend is implemented by realizing and implementing the model classes discussed in the <a href="#model">2 model section</a>. Here a summary is given of what needs to be implemented to conform to the model.
</p>
<section>
<h3>Storing groups</h3>

<p>
The backend needs to store the groups of information in some way, such that they can be found again when another reviewer opens the review in Griotte's UI.
</p>
<p>
In the case of Git-based repositories, this can be done using <a href="http://git-scm.com/docs/git-notes">git-notes</a> in some ref namespace (such as <code>refs/griotte</code>).
</p>
</section><section>
<h3>Creation of reviews and comments</h3>

<p>
The backend needs to be able to create reviews on repositories. Further, it needs to be able to create comments on reviews (top-level comments) and on groups. The creation of these two are done in their class-side creation methods:
</p>
<dl><dt><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrReview.class/README.md">GrReview</a> class</code><code>&gt;&gt;</code><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrReview.class/class/createOnRepository.withTitle.description..st">createOnRepository:withTitle:description:</a></code></dt>
<dd>As the name suggests, it creates a review with that title and description on the repository given in the first parameter.</dd>
<dd>You might notice that there is no mention of a <em>branch</em> which has to be merged into another. As these are specific to some backends, it is left as a responsibility of the backend to determine which set of changed is to be integrated, and where it is to be integrated.</dd>
<dd>In the case of Git-based repositories, one can take the currently checked out branch and integrate it in the default branch.</dd>
<dd>The GitHub backend analyzes the <a href="#epicea">2.2 Epicea</a> log and finds the latest commit. Then the branch this commit was done on will be merged with the repository's default branch. View <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-GitHub.package/GrGitHubReview.class/README.md">GrGitHubReview</a> class</code><code>&gt;&gt;</code><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-GitHub.package/GrGitHubReview.class/class/createOnRepository.withTitle.description..st">createOnRepository:withTitle:description:</a></code> for the implementation.</dd>
<dt><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrComment.class/README.md">GrComment</a> class</code><code>&gt;&gt;</code><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrComment.class/class/createOnReview.withBody..st">createOnReview:withBody:</a></code></dt>
<dt><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrComment.class/README.md">GrComment</a> class</code><code>&gt;&gt;</code><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrComment.class/class/createOnGroup.withBody..st">createOnGroup:withBody:</a></code></dt>
<dd>Two creation methods are provided for creating comments, to distinguish between creating a comment on a review and on a group.</dd>
</dl>

</section><section>
<h3>Accessing information</h3>

<p>
The implementation should be able to provide a list of repositories for a given user, and for each repository a list of reviews. These functionalities are implemented by the GitHub backend with <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-GitHub.package/GrGitHubUser.class/README.md">GrGitHubUser</a></code><code>&gt;&gt;</code><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-GitHub.package/GrGitHubUser.class/instance/allRepositories.st">allRepositories</a></code> and <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-GitHub.package/GrGitHubRepository.class/README.md">GrGitHubRepository</a></code><code>&gt;&gt;</code><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-GitHub.package/GrGitHubRepository.class/instance/allReviews.st">allReviews</a></code>.
</p>
<p>
For reviews and groups, the comments of both should be able to be provided as <code>Collection</code>s containing <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrComment.class/README.md">GrComment</a></code>s.
</p>
<p>
Further things that should be able to be accessed are obvious:
</p>
<ul>
<li>The creator, description, title of a review.</li>
<li>The creator, body, creation time and update time of a comment.</li>
<li>For a user, not much. It allows for anonymous users, meaning anyone can change any comment or review as one likes. If such operations are not possible, then it means that there is some concept of a user being logged in. Thus one might want to implement <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrUser.class/README.md">GrUser</a></code><code>&gt;&gt;</code><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrUser.class/instance/avatar.st">avatar</a></code> and <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrUser.class/README.md">GrUser</a></code><code>&gt;&gt;</code><code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrUser.class/instance/username.st">username</a></code></li>
<li>For a repository, its name.</li>
</ul>

</section></section><section>
<h2>3.2. The Connection with Version Control Systems</h2>

<p>
Griotte's model is agnostic about its connection to Version Control Systems (VCS). Thus, which branch has to be merged into which has to be determined by the backend implementation.
</p>
<section>
<h3>Porting over responsibilities</h3>

<p>
Griotte relies on external tool support for the backends. However, it might be necessary to port some of the responsibility over to Griotte's model. For example, if specifying which branches should be merged into which is desirable to be done from Griotte's UI, the model needs to be adapted for this.
</p>
</section><section>
<h3>Using a Visitor for backend-specific UI</h3>

<p>
Another approach might be to allow for flexible creation of backend-specific UI. This however does pose a challenge on integrating it within Griotte's main UI. One approach might be to extend the model with a <a href="https://en.wikipedia.org/wiki/Visitor_pattern">Visitor Pattern</a>, which can visit specific backend implementations. This way, the UI stays more separated from the model, while still allowing for creating backend-specific UI.
</p>
<p>
As Pharo supports extension methods, the Visitor implementation can easily be adapted for additional future backends.

</p></section></section></section><section>
<h1>4. The UI</h1>
<a id="ui"></a><p>
Griotte's UI is created by means of loosely coupled UI widgets wrapped around a <a href="#model">2 model object</a>. The widgets are implemented with <a href="http://spec.st">Spec</a>.
</p>
<section>
<h2>4.1. The widgets</h2>

<p>
The widgets are prefixed with <code>GrUI</code> to distinguished between the two. For example, there are <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-UI.package/GrUIReview.class/README.md">GrUIReview</a></code> and <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-UI.package/GrUIComment.class/README.md">GrUIComment</a></code>, which allow to perform the operations on the model objects they wrap through a graphical interface. Thus if one has a <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrComment.class/README.md">GrComment</a></code> object, one can do something like this to open a comment window allowing to edit the comment's body:
</p>
<figure><pre><code class="smalltalk">| comment |
&quot; comment is an instance of GrComment. &quot;
GrUIComment new
	withComment: comment;
	openWithSpec</code></pre><figcaption></figcaption></figure>

<p>
Similarly, to open a window for a <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrReview.class/README.md">GrReview</a></code> instance:
</p>
<figure><pre><code class="smalltalk">| review |
&quot; review is an instance of GrReview. &quot;
GrUIReview new
	withReview: review;
	openWithSpec</code></pre><figcaption></figcaption></figure>

<section>
<h3>Creating new widgets</h3>

<p>
With these loose widgets, one can easily recompose the UI. Thus it is desirable that when creating new widgets (e.g. for <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-Model.package/GrGroup.class/README.md">GrGroup</a></code>s, which are not implemented) a similar pattern is followed.
</p>
<p>
The widget should support the operations through its UI in one way or another. This can be done with buttons, but also with textfields and the <code>Control + S</code> (Windows/Linux) or <code>Command + S</code> (OSX) shortcuts. The latter has been done for editing the body of a comment.
</p>
</section></section><section>
<h2>4.2. Dialogs</h2>

<p>
Some utility classes for dialogs were created, which ease the creation of new dialogs. These are subclasses of <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-UI.package/GrUIDialog.class/README.md">GrUIDialog</a></code>, which contains a class comment with information to implement a new dialog class.
</p>
</section><section>
<h2>4.3. The Main Window</h2>

<p>
The main user interface, <code><a href="https://github.com/Balletie/Griotte/tree/master/Griotte-UI.package/GriotteUI.class/README.md">GriotteUI</a></code>, uses <code>AbstractLoginModel</code> as its boilerplate for displaying a username and password textfield for logging in. It is defined in the <a href="http://smalltalkhub.com/#!/~Balletie/Widget-Extensions">Widget-Extensions-Balletie</a> package. It is separate from Griotte's repository as it is used by the GitHub tool as well.
</p>
<p>
The class comment for <code>AbstractLoginModel</code> should provide enough information to use it.

</p></section></section>
    </div>
    <!-- Syntax highlighting of code blocks -->
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
